# set COVERAGE to enable coverage reporting

all: %DEST%/%LIB_NAME%

# 'all', with compilation warnings and debug symbols enabled
debug :
	%MAKE% "DBG=-Wall -g"  all

SRCS = buf.c cos.c cos_struct_elem.c filt_predict.c filt_predict_png.c filt_predict_tiff.c read.c write.c version.c
OBJS = buf%O% cos%O% cos_struct_elem%O% filt_predict%O% filt_predict_png%O% filt_predict_tiff%O% read%O% write%O% version%O%

%DEST%/%LIB_NAME%: $(OBJS)
	%LD% %LDSHARED% %LDFLAGS% %LDOUT%%DEST%/%LIB_NAME% $(OBJS) $(LD_COV_OPT)

buf%O% :
	%CC% -I .. -c %CCSHARED% %CCFLAGS% $(CC_COV_OPT) %CCOUT%$@ buf.c $(DBG)

cos%O% :
	%CC% -I .. -c %CCSHARED% %CCFLAGS% $(CC_COV_OPT) %CCOUT%$@ cos.c $(DBG)

cos_struct_elem%O% :
	%CC% -I .. -c %CCSHARED% %CCFLAGS% $(CC_COV_OPT) %CCOUT%$@ cos_struct_elem.c $(DBG)

filt_predict%O% :
	%CC% -I .. -c %CCSHARED% %CCFLAGS% $(CC_COV_OPT) %CCOUT%$@ filt_predict.c $(DBG)

filt_predict_png%O% :
	%CC% -I .. -c %CCSHARED% %CCFLAGS% $(CC_COV_OPT) %CCOUT%$@ filt_predict_png.c $(DBG)

filt_predict_tiff%O% :
	%CC% -I .. -c %CCSHARED% %CCFLAGS% $(CC_COV_OPT) %CCOUT%$@ filt_predict_tiff.c $(DBG)

read%O% :
	%CC% -I .. -c %CCSHARED% %CCFLAGS% $(CC_COV_OPT) %CCOUT%$@ read.c $(DBG)

write%O% :
	%CC% -I .. -c %CCSHARED% %CCFLAGS% $(CC_COV_OPT) %CCOUT%$@ write.c $(DBG)

version%O% :
	%CC% -I .. -c %CCSHARED% %CCFLAGS% $(CC_COV_OPT) %CCOUT%$@ version.c $(DBG)

coverage-reports : all
	gcov *.c

clean :
	@rm -f *%O% ../cos/*%O% *.gc?? %DEST%/%LIB_NAME%

realclean : clean
	@rm -f Makefile .depend

depend: .depend

.depend: $(SRCS)
	rm -f ./.depend
	%CC% -I .. %CCFLAGS% -MM $(SRCS) > ./.depend;

include .depend
